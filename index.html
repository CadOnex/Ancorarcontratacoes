<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ancorar | Plataforma de Marinheiros</title>
<link rel="stylesheet" href="css/style.css">
</head>
<body>

<header class="site-header">
  <div class="wrap">
    <h1>Ancorar</h1>
    <p class="subtitle">Plataforma de contratação de marinheiros</p>
    <button id="btn-logout" class="btn-primary" style="display:none;">Sair</button>
  </div>
</header>

<nav class="main-nav">
  <div class="wrap nav-wrap">
    <ul>
      <li><a href="#cadastro-login" id="link-login">Cadastro / Login</a></li>
      <li><a href="#envio-curriculo" id="link-curriculo" style="display:none;">Enviar Currículo</a></li>
      <li><a href="dashboard.html" id="link-dashboard" style="display:none;">Dashboard</a></li>
    </ul>
  </div>
</nav>

<main class="wrap container">

  <!-- CADASTRO / LOGIN -->
  <section id="cadastro-login">
    <h2>Cadastro</h2>
    <form id="form-cadastro">
      <label>Nome</label><input type="text" id="cad-nome" required>
      <label>E-mail</label><input type="email" id="cad-email" required>
      <label>Senha</label><input type="password" id="cad-senha" required>
      <label>Tipo</label>
      <select id="cad-tipo" required>
        <option value="marinheiro">Marinheiro</option>
        <option value="contratante">Contratante</option>
      </select>
      <button type="submit" class="btn-primary">Cadastrar</button>
    </form>

    <h2>Login</h2>
    <form id="form-login">
      <label>E-mail</label><input type="email" id="login-email" required>
      <label>Senha</label><input type="password" id="login-senha" required>
      <button type="submit" class="btn-primary">Entrar</button>
    </form>
  </section>

  <!-- ENVIO DE CURRÍCULO -->
  <section id="envio-curriculo" style="display:none;">
    <h2>Envio de Currículo</h2>
    <div id="mensagem-sucesso" class="mensagem-sucesso" style="display:none;"></div>
    <form id="form-curriculo">
      <label>Nome</label><input type="text" id="cv-nome" required>
      <label>E-mail</label><input type="email" id="cv-email" required>
      <label>Currículo (PDF)</label><input type="file" id="cv-arquivo" accept=".pdf" required>
      <button type="submit" class="btn-primary">Enviar Currículo</button>
    </form>
  </section>

</main>

<footer class="site-footer">
  <div class="wrap">
    <p>© <span id="ano"></span> Ancorar — Todos os direitos reservados.</p>
  </div>
</footer>

<script type="module">
import { cadastrarUsuario, loginUsuario, enviarCurriculo, monitorarAuth, logout, getUsuario } from './js/auth.js';

document.getElementById('ano').textContent = new Date().getFullYear();

// Cadastro
document.getElementById("form-cadastro").addEventListener("submit", e=>{
  e.preventDefault();
  cadastrarUsuario(
    document.getElementById("cad-nome").value,
    document.getElementById("cad-email").value,
    document.getElementById("cad-senha").value,
    document.getElementById("cad-tipo").value
  );
  e.target.reset();
});

// Login
document.getElementById("form-login").addEventListener("submit", e=>{
  e.preventDefault();
  loginUsuario(
    document.getElementById("login-email").value,
    document.getElementById("login-senha").value
  );
});

// Envio Currículo
document.getElementById("form-curriculo").addEventListener("submit", e=>{
  e.preventDefault();
  const arquivo = document.getElementById("cv-arquivo").files[0];
  enviarCurriculo(
    document.getElementById("cv-nome").value,
    document.getElementById("cv-email").value,
    arquivo
  ).then(()=>{
    const msg = document.getElementById("mensagem-sucesso");
    msg.textContent = "Currículo enviado com sucesso!";
    msg.style.display = "block";
    setTimeout(()=>{ msg.style.display="none"; },3000);
  });
  e.target.reset();
});

// Logout
document.getElementById("btn-logout").addEventListener("click", ()=> logout());

// Monitorar autenticação e ajustar UI
monitorarAuth(async user=>{
  if(user){
    document.getElementById("btn-logout").style.display="inline-block";

    const usuario = await getUsuario(user.uid);

    // Dashboard dinâmico
    const linkDashboard = document.getElementById("link-dashboard");
    linkDashboard.style.display = "inline-block";
    if(usuario.tipo === "marinheiro"){
      linkDashboard.textContent = "Visualizar Currículos";
      document.getElementById("envio-curriculo").style.display = "block";
    } else {
      linkDashboard.textContent = "Currículos Recebidos";
      document.getElementById("envio-curriculo").style.display = "none";
    }

    // Oculta link de login/cadastro
    document.getElementById("link-login").style.display = "none";

    // Preencher campos do currículo
    document.getElementById("cv-nome").value = user.displayName || "";
    document.getElementById("cv-email").value = user.email || "";

    document.getElementById("cadastro-login").style.display="none";
  }else{
    document.getElementById("btn-logout").style.display="none";
    document.getElementById("link-dashboard").style.display="none";
    document.getElementById("link-login").style.display="inline-block";
    document.getElementById("envio-curriculo").style.display="none";
    document.getElementById("cadastro-login").style.display="block";
  }
});
</script>

</body>
</html>
